<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kishan2Bazaar</title>
  <link rel="stylesheet" href="seeds2.css"> 

</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo">Kishan2Bazaar</div>
      <div class="search-bar">
        <input type="text" class="search-input" placeholder="Search...">
        <button class="search-button">Search</button>
      </div>
    </div>
  </header>

  <nav class="nav">
    <div class="container">
      <ul class="nav-list">
        <li class="nav-item"><a href="#" class="nav-link">Agri Machinery & Tools</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Seeds</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Fertilizers</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Irrigations</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Animal Feed & Dairy</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Flowers & Plants</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Organic Groceries</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Crop Commodities</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Agro Products</a></li>
      </ul>
    </div>
  </nav>

  <div class="content">
    <div class="container">
      <div class="product">
        <div class="product-image-container">
          <img src="images/sunflower.jpeg" alt="Quinoa Seed" class="product-image">
        </div>
        <div class="product-info">
          <h1 class="product-title">Best Quality Sunflower Seeds for Eating and Farming</h1>
          <p class="product-description">
            Sunflower seeds are a rich source of healthy fats, vitamin E, and protein. They offer a crunchy texture and mild, nutty flavor, perfect for snacking or adding to salads and baked goods. These seeds are also ideal for cultivation, producing vibrant sunflower blooms.
          <div class="product-price">₹250 per kg</div>
          <div class="product-buttons">
            <button class="product-button">Order Now</button>
            <button class="product-button">Chat with us</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>About Us</h3>
          <p>Kishan2Bazaar is your one-stop shop for all agricultural needs.</p>
        </div>
        <div class="footer-section">
          <h3>Contact Us</h3>
          <p>Email: support@kishan2bazaar.com</p>
          <p>Phone: +91 123 456 7890</p>
        </div>
        <div class="footer-section">
          <h3>Store Details</h3>
          <p>123 Agriculture Road, Farm City, India</p>
        </div>
        <div class="footer-section">
          <h3>Follow Us</h3>
          <ul class="footer-links">
            <li><a href="#">Facebook</a></li>
            <li><a href="#">Twitter</a></li>
            <li><a href="#">Instagram</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 Kishan2Bazaar. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // Add any JavaScript functionality here if needed
    document.addEventListener('DOMContentLoaded', function() {
      const productImage = document.querySelector('.product-image');
      productImage.addEventListener('click', function() {
        this.classList.toggle('rotated');
      });
    });
  </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kishan2Bazaar</title>
  <link rel="stylesheet" href="seeds2.css"> <!-- Reference to your CSS file -->

</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo">Kishan2Bazaar</div>
      <div class="search-bar">
        <input type="text" class="search-input" placeholder="Search...">
        <button class="search-button">Search</button>
      </div>
    </div>
    
  </header>

  <nav class="nav">
    <div class="container">
      <ul class="nav-list">
        <li class="nav-item"><a href="#" class="nav-link">Agri Machinery & Tools</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Seeds</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Fertilizers</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Irrigations</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Animal Feed & Dairy</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Flowers & Plants</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Organic Groceries</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Crop Commodities</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Agro Products</a></li>
      </ul>
    </div>
  </nav>

  <div class="content">
    
      <div class="container">
        <div class="product">
          <div class="product-image-container">
            <img src="images/sunflower.jpeg" alt="Quinoa Seed" class="product-image">
          </div>
          <div class="product-info">
            <h1 class="product-title">Best Quality Sunflower Seeds for Eating and Farming</h1>
            <p class="product-description">
              Sunflower seeds are a rich source of healthy fats, vitamin E, and protein. They offer a crunchy texture and mild, nutty flavor, perfect for snacking or adding to salads and baked goods. These seeds are also ideal for cultivation, producing vibrant sunflower blooms.
            <div class="product-price">₹250 per kg</div>
            <div class="product-buttons">
              <button class="product-button">Order Now</button>
              <button class="product-button">Chat with us</button>
            </div>
          </div>
        </div>
      </div>
  
    <div class="container">
      <!-- Seller Form or Buyer Product List will be dynamically displayed here -->
       
      <div id="seller-buyer-content"></div>
    </div>
  </div>
  <div id="sort-container">

  </div>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>About Us</h3>
          <p>Kishan2Bazaar is your one-stop shop for all agricultural needs.</p>
        </div>
        <div class="footer-section">
          <h3>Contact Us</h3>
          <p>Email: support@kishan2bazaar.com</p>
          <p>Phone: +91 123 456 7890</p>
        </div>
        <div class="footer-section">
          <h3>Store Details</h3>
          <p>123 Agriculture Road, Farm City, India</p>
        </div>
        <div class="footer-section">
          <h3>Follow Us</h3>
          <ul class="footer-links">
            <li><a href="#">Facebook</a></li>
            <li><a href="#">Twitter</a></li>
            <li><a href="#">Instagram</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 Kishan2Bazaar. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>

    // document.addEventListener('DOMContentLoaded', function() {
    //   const contentContainer = document.getElementById('seller-buyer-content');
    //   const userRole = localStorage.getItem('role'); // Fetch the role from localStorage
      
    //   if (userRole === 'seller') {
    //     // Seller form for product input
    //     contentContainer.innerHTML = `


          

    //       <h2>Enter Product Details</h2>
    //       <form id="seller-form">
    //         <label for="quantity">Quantity:</label>
    //         <input type="number" id="quantity" name="quantity" required><br><br>
            
    //         <label for="price">Price (₹ per kg):</label>
    //         <input type="number" id="price" name="price" required><br><br>

    //         <label for="description">Product Description:</label>
    //         <textarea id="description" name="description" required></textarea><br><br>

    //         <input type="hidden" id="itemId" value="12345"> <!-- Example itemId -->
    //         <button type="submit">Submit</button>
    //       </form>
    //     `;

    //     document.getElementById('seller-form').addEventListener('submit', async(e)=> {
    //       e.preventDefault();
    //       const quantity = document.getElementById('quantity').value;
    //       const price = document.getElementById('price').value;
    //       const description = document.getElementById('description').value;
    //       const itemId = 101;

    //       const email = localStorage.getItem("userEmail");

    //       // Save data to a hypothetical database
    //       try {
    //         const response = await axios.post('/seller-post', { 
    //           email,
    //           quantity,
    //           price,
    //           description,
    //           itemId
    //            });
    //         alert(response.data.message);


    //     } catch (error) {
    //         alert(error.response.data.message || 'An error occurred');
    //     }

          
    //     });
    //   } else if (userRole === 'buyer') {
      


    //     console.log("Buyer");
    //         async function getAvailableProducts() {
    //             const email = localStorage.getItem('userEmail');  // Retrieve the email from local storage
    //             const role = localStorage.getItem('role');
    //             const itemId = 12345;  // For example, set itemId dynamically if needed.

    //             if (!email || !role) {
    //                 alert('No user is logged in');
    //                 window.location.href = '/buyer-login.html';  // Redirect to login page if not logged in
    //                 return;
    //             }

    //             try {
    //                 // Send a POST request to fetch items by itemId
    //                 const response = await axios.post('http://localhost:5000/buyer-get', { email, itemId });
    //                 const items = response.data;

    //                 // Check if there are items available
    //                 if (items.length === 0) {
    //                     contentContainer.innerHTML = `<p>No items available.</p>`;
    //                 } else {
    //                     // Display available items
    //                     let productList = '<h2>Available Products</h2>';
    //                     items.forEach(itemData => {
    //                         productList += `
    //                             <div class="product-card">
    //                                 <p><strong>Item Description:</strong> ${itemData.item.itemDescription}</p>
    //                                 <p><strong>Quantity:</strong> ${itemData.item.itemQuantity} kg</p>
    //                                 <p><strong>Price:</strong> ₹${itemData.item.itemPrice} per kg</p>
    //                                 <p><strong>Seller:</strong> ${itemData.sellerName} (${itemData.sellerEmail})</p>
    //                                 <hr>
    //                             </div>
    //                         `;
    //                     });
    //                     contentContainer.innerHTML = productList;
    //                 }

    //             } catch (error) {
    //                 console.error('Error fetching available products', error);
    //                 alert('Error fetching products: ' + (error.response?.data?.message || 'Unknown error'));
    //             }
    //         }

    //         // Fetch and display available products when the buyer loads the page
    //         getAvailableProducts();

    //   } else {
    //     // Default message for unknown roles
    //     contentContainer.innerHTML = `<p>No role defined or incorrect role. Please login as either buyer or seller.</p>`;
    //   }
    // });


    document.addEventListener('DOMContentLoaded', function() {
      const contentContainer = document.getElementById('seller-buyer-content');
      const userRole = localStorage.getItem('role'); // Fetch the role from localStorage
      
      if (userRole === 'seller') {
        // Seller form for product input
        contentContainer.innerHTML = `
          <h2>Enter Product Details</h2>
          <form id="seller-form">
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" required><br><br>
            
            <label for="price">Price (₹ per kg):</label>
            <input type="number" id="price" name="price" required><br><br>

            <label for="description">Product Description:</label>
            <textarea id="description" name="description" required></textarea><br><br>

            <input type="hidden" id="itemId" value="12345"> <!-- Example itemId -->
            <button type="submit">Submit</button>


            <input type="file" id="image" accept="image/*" required><br>


          </form>
           <p id="message"></p>
          <h2>Your Uploaded Products</h2>
          <div id="seller-products"></div> <!-- This div will display the seller's products -->
        `;

        // Handle the product submission
        document.getElementById('seller-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const quantity = document.getElementById('quantity').value;
          const price = document.getElementById('price').value;
          const description = document.getElementById('description').value;
          const itemId = 101

          const email = localStorage.getItem("userEmail");

          const fileInput = document.getElementById('image');
          const file = fileInput.files[0];

          if (!file) {
            alert('Please upload an image.');
           return;
          }
          
  // Convert the image to Base64
  const reader = new FileReader();
    reader.onloadend = async function () {
        const base64Image = reader.result;
        const itemImg = base64Image;

        try {
            // Send a POST request to the server with all the form data and the image
            const response = await axios.post('/seller-post', {
                email,
                quantity,
                price,
                description,
                itemId,
                itemImg // Send the Base64 image to the server
            });

            alert(response.data.message);
            loadSellerProducts(); // Reload the products after submission
        } catch (error) {
            alert(error.response?.data?.message || 'An error occurred');
        }
    };

    reader.readAsDataURL(file);  // Convert image to Base64
});

          

        // Function to load the seller's uploaded products
        async function loadSellerProducts() {
    const email = localStorage.getItem("userEmail");

    try {
        const response = await axios.post('/seller-get-products', { email });
        const products = response.data;

        const sellerProductsContainer = document.getElementById('seller-products');

        if (products.length === 0) {
            sellerProductsContainer.innerHTML = `<p>No products uploaded yet.</p>`;
        } else {
            let productList = '';
            products.forEach((product) => {
                productList += `
                    <div class="product-card">
                        <img src="${product.itemImg}" alt="Product Image" style="width:150px;height:150px;"><br>
                        <p><strong>Item Description:</strong> ${product.itemDescription}</p>
                        <p><strong>Quantity:</strong> ${product.itemQuantity} kg</p>
                        <p><strong>Price:</strong> ₹${product.itemPrice} per kg</p>
                        <button class="remove-button" data-item-id="${product._id}">Remove</button>
                        <hr>
                    </div>
                `;
            });
            sellerProductsContainer.innerHTML = productList;
        }
    } catch (error) {
        console.error('Error fetching seller products:', error); // Full error logging
        alert(`Error fetching your products: ${error.response?.data?.message || error.message || 'Unknown error'}`);
    }
}

        const removeButtons = document.querySelectorAll('.remove-button');
            removeButtons.forEach(button => {
              button.addEventListener('click', async function () {
                const itemId = this.getAttribute('data-item-id');
                try {
                  const removeResponse = await axios.post('http://localhost:5000/seller-remove-product', {
                    email,
                    itemId
                  });
                  alert(removeResponse.data.message);
                  getSellerProducts(); // Refresh the product list after removal
                } catch (error) {
                  alert('Error removing product: ' + (error.response?.data?.message || 'Unknown error'));
                }
              });
            });

        // Load the seller's uploaded products when the page loads
        loadSellerProducts();

       } else if (userRole === 'buyer') {

        


        
    console.log("Buyer");

    let items = []; // Store the fetched items here

    async function getAvailableProducts() {
        const email = localStorage.getItem('userEmail');  // Retrieve the email from local storage
        const role = localStorage.getItem('role');
        const itemId = 101;  // Example: Set itemId dynamically as needed.

        if (!email || !role) {
            alert('No user is logged in');
            window.location.href = '/buyer-login.html';  // Redirect to login page if not logged in
            return;
        }

        try {
            // Send a POST request to fetch items by itemId
            const response = await axios.post('http://localhost:5000/buyer-get', { itemId });
            items = response.data;  // Store response in the items array

            // Check if there are items available
            if (items.length === 0) {
                contentContainer.innerHTML = `<p>No items available.</p>`;
            } else {
                // Initially sort by price (default)
                sortItems('price');
            }

        } catch (error) {
            console.error('Error fetching available products', error);
            alert('Error fetching products: ' + (error.response?.data?.message || 'Unknown error'));
        }
    }

    // Function to render products based on the sorted array
    function displayProducts(sortedItems) {
        let productList = '<h2>Available Products</h2> <br>';

        sortedItems.forEach(itemData => {
            productList += `
                <div class="product-card">
                    <img src="${itemData.item.itemImg}" alt="Product Image" style="width:150px;height:150px;"><br>
                    <p><strong>Item Description:</strong> ${itemData.item.itemDescription}</p>
                    <p><strong>Quantity:</strong> ${itemData.item.itemQuantity} kg</p>
                    <p><strong>Price:</strong> ₹${itemData.item.itemPrice} per kg</p>
                    <p><strong>Seller:</strong> ${itemData.sellerName} (${itemData.sellerEmail})</p>
                    <button class="add-to-cart-button" data-item-id="${itemData.item.itemId}" data-item-price="${itemData.item.itemPrice}" data-item-quantity="${itemData.item.itemQuantity}" data-seller-email="${itemData.sellerEmail}">Add to Cart</button>
                    <hr>
                </div>
            `;
        });

        contentContainer.innerHTML = productList;

        // Add event listeners to all "Add to Cart" buttons
        document.querySelectorAll('.add-to-cart-button').forEach(button => {
            button.addEventListener('click', async (e) => {
                const itemId = e.target.getAttribute('data-item-id');
                const itemPrice = e.target.getAttribute('data-item-price');
                const itemQuantity = e.target.getAttribute('data-item-quantity');
                const sellerEmail = e.target.getAttribute('data-seller-email');

                try {
                    const response = await axios.post('http://localhost:5000/buyer-add-to-cart', {
                        email,
                        itemId,
                        itemPrice,
                        itemQuantity,
                        itemDescription,
                        sellerEmail
                    });
                    alert(response.data.message || 'Item added to cart');
                } catch (error) {
                    console.error('Error adding item to cart', error);
                    alert('Error adding item to cart: ' + (error.response?.data?.message || 'Unknown error'));
                }
            });
        });
    }

    // Function to sort items based on the selected criteria
    function sortItems(criteria) {
        let sortedItems;

        if (criteria === 'price') {
            sortedItems = items.sort((a, b) => a.item.itemPrice - b.item.itemPrice);
        } else if (criteria === 'quantity') {
            sortedItems = items.sort((a, b) => a.item.itemQuantity - b.item.itemQuantity);
        } else if (criteria === 'quality') {
            // No quality sorting yet, but placeholder for future logic
            sortedItems = items; 
        }

        // Display sorted products
        displayProducts(sortedItems);
    }

    // Add sorting dropdown in the DOM
    function addSortDropdown() {
        const sortDropdown = `
        
            <label for="sort-container">Sort by:</label>
            <select id="sort" name="sort">
                <option value="price" selected>Price</option>
                <option value="quantity">Quantity</option>
                <option value="quality">Quality</option>
            </select>
          
        `;

        document.getElementById('sort-container').innerHTML = sortDropdown;

        // Add event listener to handle sorting when selection changes
        document.getElementById('sort').addEventListener('change', (e) => {
            const selectedCriteria = e.target.value;
            sortItems(selectedCriteria);
        });
    }

    // Fetch and display available products when the buyer loads the page
    getAvailableProducts();

    // Add sorting dropdown once the page is loaded
    addSortDropdown();











      //   console.log("Buyer");

      // async function getAvailableProducts() {
      //   const email = localStorage.getItem('userEmail');  // Retrieve the email from local storage
      //   const role = localStorage.getItem('role');
      //   const itemId = 101;  // Example: Set itemId dynamically as needed.

      //   if (!email || !role) {
      //     alert('No user is logged in');
      //     window.location.href = '/buyer-login.html';  // Redirect to login page if not logged in
      //     return;
      //   }

      //   try {
      //     // Send a POST request to fetch items by itemId
      //     const response = await axios.post('http://localhost:5000/buyer-get', { itemId });
      //     const items = response.data;

      //     // Check if there are items available
      //     if (items.length === 0) {
      //       contentContainer.innerHTML = `<p>No items available.</p>`;
      //     } else {
      //       // Display available items
      //       let productList = '<h2>Available Products</h2>';
      //       items.forEach(itemData => {
      //         productList += `
      //           <div class="product-card">
      //             <img src="${itemData.item.itemImg}" alt="Product Image" style="width:150px;height:150px;"><br>
      //             <p><strong>Item Description:</strong> ${itemData.item.itemDescription}</p>
      //             <p><strong>Quantity:</strong> ${itemData.item.itemQuantity} kg</p>
      //             <p><strong>Price:</strong> ₹${itemData.item.itemPrice} per kg</p>
      //             <p><strong>Seller:</strong> ${itemData.sellerName} (${itemData.sellerEmail})</p>
      //             <button class="add-to-cart-button" data-item-id="${itemData.item.itemId}" data-item-price="${itemData.item.itemPrice}" data-item-quantity="${itemData.item.itemQuantity}" data-seller-email="${itemData.sellerEmail}">Add to Cart</button>

      //             <hr>
      //           </div>
      //         `;
      //       });
      //       contentContainer.innerHTML = productList;

      //       document.querySelectorAll('.add-to-cart-button').forEach(button => {
      //               button.addEventListener('click', async (e) => {
      //                   const itemId = e.target.getAttribute('data-item-id');
      //                   const itemPrice = e.target.getAttribute('data-item-price');
      //                   const itemQuantity = e.target.getAttribute('data-item-quantity');
      //                   const sellerEmail = e.target.getAttribute('data-seller-email');

      //                   try {
      //                       const response = await axios.post('http://localhost:5000/buyer-add-to-cart', {
      //                           email,
      //                           itemId,
      //                           itemPrice,
      //                           itemQuantity,
      //                           sellerEmail
      //                       });
      //                       alert(response.data.message || 'Item added to cart');
      //                   } catch (error) {
      //                       console.error('Error adding item to cart', error);
      //                       alert('Error adding item to cart: ' + (error.response?.data?.message || 'Unknown error'));
      //                   }
      //               });
      //           });
            




      //     }

      //     } catch (error) {
      //       console.error('Error fetching available products', error);
      //       alert('Error fetching products: ' + (error.response?.data?.message || 'Unknown error'));
      //     }
      //   }

        // Fetch and display available products when the buyer loads the page
        // getAvailableProducts();

      } else {
        // Default message for unknown roles
        //contentContainer.innerHTML = `<p>No role defined or incorrect role. Please login as either buyer or seller.</p>`;
      }
    });




  </script>
</body>
</html>
